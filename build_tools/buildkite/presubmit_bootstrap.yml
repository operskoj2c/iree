# Copyright 2022 The IREE Authors
#
# Licensed under the Apache License v2.0 with LLVM Exceptions.
# See https://llvm.org/LICENSE.txt for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

# Note that this file is *not* proccessed with "upload-pipeline" on presubmit
# because then it would be editable by PRs from forks. For now, this is checked
# in here and then copy-pasted into the Buildkite UI. Automatic updates to
# follow.

steps:
  - label: ":pipeline: Uploading presubmit pipeline"
    agents:
      queue: "orchestration"
      security: "submitted"
    # We're not checking out from the PR and besides saving time, we really
    # don't want to because we don't want unsubmitted code on these executors at
    # all.
    plugins:
      - thedyrt/skip-checkout#0870506e0b5d4becc164c6e64dbc331938f0bdcf:
          cd: /tmp/
    commands: |
      # Piped rather than wget to avoid unnecessary intermediate files (that can
      # cause confusion if not handled properly)
      curl \
        https://raw.githubusercontent.com/google/iree/main/build_tools/buildkite/presubmit.yml \
        | buildkite-agent pipeline upload
